<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RuleApp</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	</head>
	<body class="flex bg-white h-screen w-screen overflow-hidden">
		<div class="flex-1 overflow-hidden">
			<div class="h-1/2 bg-blue-500 w-screen">
				<img class="w-full h-full object-cover" src="./img/0AD 1.png" />
			</div>
			<div class="h-1/2 bg-white w-screen">
				<div class="flex flex-col w-screen p-10">
					<h1 class="text-4xl mb-5 font-bold">RuleApp</h1>
					<div
						id="tagsSelected"
						class="min-h-10 flex w-full p-2 pl-0 rounded-full overflow-x-scroll mb-2"
					>
						<li
							class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 min-h-9 list-none bg-gray-200 text-black p-1 px-5 rounded-full"
						>
							<span class="opacity-0">..........</span>
						</li>
						<li
							class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 min-h-9 list-none bg-gray-200 text-black p-1 px-5 rounded-full"
						>
							<span class="opacity-0">..........</span>
						</li>
					</div>
					<input
						class="w-full mb-2 p-3 rounded-full border-2 border-2 border-black"
						placeholder="Search tags..."
						type="text"
						id="searchTagsInput"
					/>
					<div
						id="tagsSearched"
						class="flex w-full p-2 min-h-10 pl-0 rounded-full overflow-x-scroll mb-3"
					>
						<li
							class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 min-h-9 list-none bg-gray-200 text-black p-1 px-5 rounded-full"
						>
							<span class="opacity-0">..........</span>
						</li>
						<li
							class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 min-h-9 list-none bg-gray-200 text-black p-1 px-5 rounded-full"
						>
							<span class="opacity-0">..........</span>
						</li>
						<li
							class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 min-h-9 list-none bg-gray-200 text-black p-1 px-5 rounded-full"
						>
							<span class="opacity-0">..........</span>
						</li>
					</div>

					<button
						id="buttomGoToGalery"
						class="hover:opacity-40 bg-black text-white p-3 w-full rounded-full"
					>
						Continue
					</button>
				</div>
			</div>
		</div>
	</body>
	<script
		type="text/javascript"
		src="https://code.jquery.com/jquery-1.12.3.js"
	></script>

	<script>
		$("#buttomGoToGalery").click(function (event) {
			goToGalery();
		});
		$("#searchTagsInput").on("input", function () {
			searchTags($(this).val());
		});

		const BACKEND_URL = "https://ruleappserver-10d4170b9aef.herokuapp.com";
		const tagsSelected = [];
		const tagsSearched = [];

		//hacer scroll hasta el final de las tags
		function scrollToHorizontalEnd(element) {
			element.scrollLeft = element.scrollWidth - element.clientWidth;
		}
		//==========================================================================

		function deleteTagsSelected(index) {
			tagsSelected.splice(index, 1);
			document.getElementById("tagsSelected").innerHTML = tagsSelected.map(
				(tag, index) => {
					return `<li style="white-space: nowrap"  class="h-9 hover:opacity-40 mx-1 items-center justify-center flex font-bold list-none bg-black text-white p-1 px-4 rounded-full"><span class="ml-2">${tag}</span><img class="w-4 h-4 ml-1" onclick="deleteTagsSelected(${index})" src="./img/close.svg"/></li>`;
				}
			);
		}

		function addTags(tags) {
			tagsSelected.push(tags);
			document.getElementById("tagsSelected").innerHTML = tagsSelected.map(
				(tag, index) => {
					return `<li onclick="deleteTagsSelected(${index})" style="white-space: nowrap"  class="h-9 hover:opacity-40 mx-1 items-center justify-center flex font-bold list-none bg-black text-white p-1 px-4 rounded-full"><span class="ml-2">${tag}</span><img class="w-4 h-4 ml-1" src="./img/close.svg"/></li>`;
				}
			);

			const scrollableElement = document.getElementById("tagsSelected");
			scrollToHorizontalEnd(scrollableElement);
			document.getElementById("searchTagsInput").value = "";
		}

		function showSelectedTags(tags) {
			document.getElementById("tagsSearched").innerHTML = tags.map((tag) => {
				return `<li onclick="addTags('${tag.name}')" style="white-space: nowrap" class="hover:opacity-40 flex items-center w-auto mx-1 max-h-9 list-none bg-white border-2 border-black text-black p-1 px-5 rounded-full" > ${tag.name} <img class="w-3 h-3 ml-2" src="./img/arrow1.png"/> </li>`;
			});
		}

		async function searchTags(el) {
			const textoConGuiones = el.replaceAll(/ /g, "_");
			$("#searchTagsInput").val(textoConGuiones);

			let reqOptions = {
				url: `${BACKEND_URL}/rule/tags/${el}`,
				method: "GET",
			};

			let response = await axios.request(reqOptions);
			if (!response.data.null) {
				showSelectedTags(response.data);
			} else {
				console.log("no se ha encontrado nada");
			}
		}

		function goToGalery() {
			window.localStorage.setItem("tagsSelected", JSON.stringify(tagsSelected));
			window.location.href = "./galery.html";
		}

		function removeCurrentPage() {
			window.localStorage.removeItem("currentPage");
		}
		removeCurrentPage();
	</script>
</html>
